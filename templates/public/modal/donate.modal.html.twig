{% extends 'public/modal/base.html.twig' %}
{% set classes = 'kudos_form_modal' %}
{% set premium = false %}

{% block header %}
    {{ header|raw }}
{% endblock header %}

{% block content %}

    <form class="kudos_form m-0 p-0" action="">

        <input required name="return_url" type="hidden" value="{{ return_url }}">
        <input name="campaign_id" type="hidden" value="{{ campaign.id }}">

        <div class="form-tabs block">

            {# INITIAL FIELDS #}
            {% embed '/public/modal/embeds/_tab.html.twig' %}
                {% block title %}{{ campaign.modal_title }}{% endblock %}
                {% block text %}{{ campaign.welcome_text }}{% endblock %}
                {% block body %}
                    {% from "/public/macros/form.html.twig" import input_group, radio_buttons, text, radio %}

                    {% if ( campaign.amount_type != 'open' ) %}
                        {{ radio_buttons(campaign.fixed_amounts|split(','), 'amount-' ~ modal_id ) }}
                    {% endif %}

                    {% if campaign.amount_type == 'both' %}
                        {{ input_group( '', __('Other', 'kudos-donations'), __('Amount', 'kudos-donations') ~ ' (€)',
                            {
                                'input': { 'id': 'value_open-' ~ modal_id,'min': '1', 'data-type': 'currency'  }
                            }
                        ) }}
                    {% endif %}

                    {% if campaign.amount_type == 'open' %}
                        {{ text('value', __('Amount', 'kudos-donations') ~ ' (€)', 'text', true, {'min': '1', 'data-type': 'currency'}) }}
                    {% endif %}

                    {{ text('name', __('Name', 'kudos-donations')) }}
                    {{ text('email_address', __('E-mail address', 'kudos-donations'), 'email') }}

                    {% if (campaign.donation_type == 'oneoff' or recurring_allowed == false) %}
                        <input required checked type="hidden" name="payment_frequency" value="oneoff"/>
                    {% elseif(campaign.donation_type == 'recurring') %}
                        <input required checked type="hidden" name="payment_frequency" value="recurring"/>
                    {% else %}
                        {{ radio('payment_frequency', {
                            'oneoff': __('One-off', 'kudos-donations'),
                            'recurring': __('Recurring', 'kudos-donations')
                        }, 'oneoff') }}
                    {% endif %}

                {% endblock %}
                {% block back_button %}{% endblock %}
            {% endembed %}

            {# PAYMENT FREQUENCY TAB #}
            {% embed '/public/modal/embeds/_tab.html.twig' with { requirements: '{"payment_frequency":"recurring"}'} %}
                {% block title %}{{ __('Subscription', 'kudos-donations') }}{% endblock %}
                {% block text %}{{ __('How often would you like to donate?', 'kudos-donations') }}{% endblock %}
                {% block body %}
                    {% from "/public/macros/form.html.twig" import select %}

                    {{ select('recurring_frequency', __('Payment frequency', 'kudos-donations'), {
                        '12 months': __('Yearly', 'kudos-donations'),
                        '3 months': __('Quarterly', 'kudos-donations'),
                        '1 month': __('Monthly', 'kudos-donations')
                    } ) }}

                    {% set length = { 0: __('Continuous', 'kudos-donations') } %}
                    {% for i in 1..10 %}
                        {% set length = length | merge({
                            (i): _n( '%u year', '%u years', i, 'kudos-donations' )|format(i)
                        }) %}
                    {% endfor %}
                    {{ select('recurring_length', __('Donation duration', 'kudos-donations'), length ) }}

                {% endblock %}
            {% endembed %}

            {# ADDRESS TAB #}
            {% if(campaign.address_enabled) %}
                {% embed '/public/modal/embeds/_tab.html.twig' %}
                    {% block title %}{{ __('Address', 'kudos-donations') }}{% endblock %}
                    {% block text %}{{ __('Please fill in your address', 'kudos-donations') ~ (campaign.address_required ? null : ' (' ~ __('optional', 'kudos-donations') ~ ')') }}{% endblock %}
                    {% block body %}
                        {% from "/public/macros/form.html.twig" import text %}

                        {% set required = (campaign.address_required ? 'required' : null) %}

                        {{ text('business_name', __('Business name', 'kudos-donations'), 'text', false) }}
                        {{ text('street', __('Street', 'kudos-donations'), 'text', required) }}
                        {{ text('postcode', __('Postcode', 'kudos-donations'), 'text', required) }}
                        {{ text('city', __('City', 'kudos-donations'), 'text', required) }}
                        {{ text('country', __('Country', 'kudos-donations'), 'text', required) }}
                    {% endblock %}
                {% endembed %}
            {% endif %}

            {# FINAL TAB #}
            {% embed '/public/modal/embeds/_tab.html.twig' with { class: 'final' } %}
                {% from "/public/macros/buttons.html.twig" import button %}
                {% block title %}{{ __('Payment', 'kudos-donations') }}{% endblock %}
                {% block text %}{{ __('By clicking donate you agree to the following payment:', 'kudos-donations') }}{% endblock %}
                {% block body %}
                    {% from "/public/macros/form.html.twig" import checkbox %}

                    <div class="kudos_summary kd-text-left kd-block kd-bg-gray-200 kd-p-2 kd-border-0 kd-border-solid kd-border-t-2 kd-border-primary">
                        <p class="kd-block kd-mb-0"><strong>{{ __('Name', 'kudos-donations') }}: </strong><span
                                    class="summary_name"></span></p>
                        <p class="kd-block kd-mb-0"><strong>{{ __('E-mail address', 'kudos-donations') }}
                                : </strong><span
                                    class="summary_email"></span></p>
                        <p class="kd-block kd-mb-0"><strong>{{ __('Amount', 'kudos-donations') }}: </strong>€<span
                                    class="summary_value"></span></p>
                        <p><strong>{{ __('Type', 'kudos-donations') }}: </strong><span class="summary_frequency"></span>
                        </p>
                    </div>

                    {% if (privacy_link) %}
                        {{ checkbox('privacy', __( 'I agree with the %1$s privacy policy %2$s.', 'kudos-donations' ) |
                            format('<a class="kd-text-primary hover:kd-text-primary-dark kd-shadow-none focus:kd-underline kd-cursor-pointer kd-ml-1" target="_blank" href='~privacy_link~' >', '</a>')) }}
                    {% endif %}

                    {% if (terms_link) %}
                        {{ checkbox('terms', __( 'I agree with the %1$s terms and conditions %2$s.', 'kudos-donations' ) |
                            format( '<a class="kd-text-primary hover:kd-text-primary-dark kd-shadow-none focus:kd-underline kd-cursor-pointer kd-ml-1" target="_blank" href='~terms_link~'>', '</a>')) }}
                    {% endif %}

                {% endblock %}
                {% block next_button %}
                    {{ button(__('Donate', 'kudos-donations'), 'primary', 'submit', {'class': 'kudos_submit kd-ml-3'}) }}
                {% endblock %}

                {% block footer %}
                    <div class="kd-secure-mollie kd-flex kd-items-center kd-justify-center kd-text-xs kd-leading-loose kd-text-gray-500">
                        {{ __( 'Secure payment by', 'kudos-donations' ) }}
                    </div>
                {% endblock %}
            {% endembed %}
        </div>
    </form>

{% endblock content %}
